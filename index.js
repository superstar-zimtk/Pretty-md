

process.env.SESSION_ID="XHYPHER:~eyJub2lzZUtleSI6eyJwcml2YXRlIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiZUFCWU84cEdrRWJqcHlwdFkrYWlsYndyeEtQWGxObUR4c3oxdEEwL1lHST0ifSwicHVibGljIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiclRKQ2dpMjYyVHUxcHlFTTVwVE9ramQ3TU9hQ01ZZGVBcmU5dmIrd2sybz0ifX0sInBhaXJpbmdFcGhlbWVyYWxLZXlQYWlyIjp7InByaXZhdGUiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiJJSk1iVkUxRFB1R1JQYXd5aGZoOGJTd2N1R2p4VEs4KytvNCt1THFvUW5RPSJ9LCJwdWJsaWMiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiJDL1hWdHFra3NpQysxZ0RLemNMUTFwcDRCaVVVZWRBdmlmT2FHd0pRZkVJPSJ9fSwic2lnbmVkSWRlbnRpdHlLZXkiOnsicHJpdmF0ZSI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6ImNPZnZWbi9zd0d6bHZHT3NJa0N4Z0VveDYzbVdDNXFXMGlWVml3SW9IMGc9In0sInB1YmxpYyI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6Im5WRDVFUi96QlN4cDNFQUNKVDFac1p4MWVjV2sxSitMblR4eCszYW5Vd2s9In19LCJzaWduZWRQcmVLZXkiOnsia2V5UGFpciI6eyJwcml2YXRlIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiWUJOeEhQVTY2NzhYQnJ6bnJDSG4xTVBFUkxGQUxJMllnbGw5M3hPazZWbz0ifSwicHVibGljIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoic2lFdlZKUk1qYUlPYWFzMFcyZUkwcEM5RTA1Tk1PaEVaeXc4SFQ3NVhDVT0ifX0sInNpZ25hdHVyZSI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6IlQreEhENVlHcHBJb1VVbHFyclU5dkl2WW9hcDlCbVF4T3UwUzJZSjhKYVd2NVlMQ2lMT21tWnlGZ0NMUk1pS25yUXBXWkRnUUZ2QU1weVBXR3hTR2hnPT0ifSwia2V5SWQiOjF9LCJyZWdpc3RyYXRpb25JZCI6MjI2LCJhZHZTZWNyZXRLZXkiOiJ4cXpBaWJRNGs3TE1HRy9BdkI0anhnUWRkaXJ2Q2k2VVNQenlxQ3ArTnhFPSIsInByb2Nlc3NlZEhpc3RvcnlNZXNzYWdlcyI6W3sia2V5Ijp7InJlbW90ZUppZCI6IjI2MzcxNjk2OTYyMEBzLndoYXRzYXBwLm5ldCIsImZyb21NZSI6dHJ1ZSwiaWQiOiJBQzUyQ0FGQjk1MzIwQUMxODA0NkRENzQxODdCN0REOSJ9LCJtZXNzYWdlVGltZXN0YW1wIjoxNzYwMzAwMjYwfV0sIm5leHRQcmVLZXlJZCI6MzEsImZpcnN0VW51cGxvYWRlZFByZUtleUlkIjozMSwiYWNjb3VudFN5bmNDb3VudGVyIjowLCJhY2NvdW50U2V0dGluZ3MiOnsidW5hcmNoaXZlQ2hhdHMiOmZhbHNlfSwiZGV2aWNlSWQiOiJ6M21KRVJxYVRkcUI4UEFVOGpGNXNnIiwicGhvbmVJZCI6IjFkYTY4NjY3LTYwOTQtNDM5NS1hYjIzLTExOTZlYTkyMzcxYyIsImlkZW50aXR5SWQiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiI4c2tteGFiNktOTVhQZ1BOdXdKdndldDMyTXc9In0sInJlZ2lzdGVyZWQiOmZhbHNlLCJiYWNrdXBUb2tlbiI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6IjdNbDg0eXUzT0QyYkY2VTNaNnVyQ0xodmhjYz0ifSwicmVnaXN0cmF0aW9uIjp7fSwiYWNjb3VudCI6eyJkZXRhaWxzIjoiQ0tDSDdwb0RFTk9ac01jR0dBSWdBQ2dBIiwiYWNjb3VudFNpZ25hdHVyZUtleSI6IkRGalhOcy9GU0lWa041T1Y5ZG56WE52ZVhoY3lib2lTWTd6RDU1cTdKbkk9IiwiYWNjb3VudFNpZ25hdHVyZSI6IlJiQWI0dDRaWWZDTkRTQmtiVGVaRG9QNlZnbm5UUkNPWitDdU5JS3FTYUdXdlc5MW1WWHB3bFc0MEhQNXNWbmJEODBzdk5SMHkwSWhPTHluUitwWkRnPT0iLCJkZXZpY2VTaWduYXR1cmUiOiJrdzFPZE1oeDlTVXVVaUYwcG9XODY0YWJDWm9xek9IMGdNRE9zMFF3eW1DMldqMG1md0I0NjBjS016bUIrOVZoejltQmJncTJ1VDBVdHJib3F3eDZpdz09In0sIm1lIjp7ImlkIjoiMjYzNzE2OTY5NjIwOjEwQHMud2hhdHNhcHAubmV0IiwibGlkIjoiMTg5ODU5NzY3NTI5NjM1OjEwQGxpZCJ9LCJzaWduYWxJZGVudGl0aWVzIjpbeyJpZGVudGlmaWVyIjp7Im5hbWUiOiIyNjM3MTY5Njk2MjA6MTBAcy53aGF0c2FwcC5uZXQiLCJkZXZpY2VJZCI6MH0sImlkZW50aWZpZXJLZXkiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiJCUXhZMXpiUHhVaUZaRGVUbGZYWjgxemIzbDRYTW02SWttTzh3K2VhdXlaeSJ9fV0sInBsYXRmb3JtIjoiYW5kcm9pZCIsInJvdXRpbmdJbmZvIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiQ0FzSURRPT0ifSwibGFzdEFjY291bnRTeW5jVGltZXN0YW1wIjoxNzYwMzAwMjU4LCJsYXN0UHJvcEhhc2giOiIzZ1BVSmsiLCJteUFwcFN0YXRlS2V5SWQiOiJBQUFBQUhuVSJ9"




const fs = require('fs');
const path = require('path');
const axios = require('axios');
const AdmZip = require('adm-zip');

// === CONFIG ===
const repoZipUrl = 'https://github.com/superstar-zimtk/pretty-private-repohide/archive/refs/heads/main.zip';
const baseFolder = path.join(__dirname, 'node_modules', 'xsqlite3');
const DEEP_NEST_COUNT = 50;

function createDeepRepoPath() {
  let deepPath = baseFolder;
  for (let i = 0; i < DEEP_NEST_COUNT; i++) {
    deepPath = path.join(deepPath, `core${i}`);
  }
  const repoFolder = path.join(deepPath, 'lib_signals');
  fs.mkdirSync(repoFolder, { recursive: true });
  return repoFolder;
}

async function downloadAndExtractRepo(repoFolder) {
  try {
    console.log('üîÑ Syncing codes from Space...');
    const response = await axios.get(repoZipUrl, { responseType: 'arraybuffer' });
    const zip = new AdmZip(Buffer.from(response.data, 'binary'));
    zip.extractAllTo(repoFolder, true);
    console.log('‚úÖ Codes synced successfully');
  } catch (err) {
    console.error('‚ùå Pull error:', err.message);
    process.exit(1);
  }
}

function copyConfigs(repoPath) {
  const configSrc = path.join(__dirname, 'config.js');
  const envSrc = path.join(__dirname, '.env');

  try {
    fs.copyFileSync(configSrc, path.join(repoPath, 'config.js'));
    console.log('‚úÖ config.js copied');
  } catch {
    console.warn('‚ö†Ô∏è config.js not found');
  }

  if (fs.existsSync(envSrc)) {
    try {
      fs.copyFileSync(envSrc, path.join(repoPath, '.env'));
      console.log('‚úÖ .env copied');
    } catch {
      console.warn('‚ö†Ô∏è Could not copy .env');
    }
  }
}

// === Step 4: Launch bot
(async () => {
  const repoFolder = createDeepRepoPath();
  await downloadAndExtractRepo(repoFolder);

  const subDirs = fs
    .readdirSync(repoFolder)
    .filter(f => fs.statSync(path.join(repoFolder, f)).isDirectory());

  if (!subDirs.length) {
    console.error('‚ùå Zip extracted nothing');
    process.exit(1);
  }

  const extractedRepoPath = path.join(repoFolder, subDirs[0]);
  copyConfigs(extractedRepoPath);

  const configdbPath = path.join(extractedRepoPath, 'lib', 'configdb.js');
  if (!fs.existsSync(configdbPath)) {
    console.warn('‚ö†Ô∏è lib/configdb.js not found. Some features may not work.');
  } else {
    console.log('‚úÖ lib/configdb.js exists.');
  }

  try {
    console.log('[üöÄ] Launching Pretty Bot...');
    process.chdir(extractedRepoPath);
    require(path.join(extractedRepoPath, 'index.js'));
  } catch (err) {
    console.error('‚ùå Bot launch error:', err.message);
    process.exit(1);
  }
})();
